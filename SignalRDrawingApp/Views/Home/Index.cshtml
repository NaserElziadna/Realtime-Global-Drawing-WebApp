@{
    ViewData["Title"] = "Home Page";
}

<!-- Login Modal -->
<div class="modal fade" id="loginModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Welcome to Drawing Room</h5>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="userName">Please enter your name:</label>
                    <input type="text" class="form-control" id="userName" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="joinRoom">Join Room</button>
            </div>
        </div>
    </div>
</div>

<div class="app-container">
    <!-- Canvas Area -->
    <partial name="_CanvasPartial" />
    
    <!-- Chat Sidebar -->
    <partial name="_ChatPartial" />
</div>

<!-- File Saved Modal -->
<div class="modal fade" id="file-saved-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Your Infiniboard</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
                    To load this Infiniboard file in the future, just drag and drop the <span class="text-monospace">infiniboard.json</span>
                    file onto a fresh Infiniboard room.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="help-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Infiniboard controls</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-center">
                <p>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <td class="font-weight-bold">Drawing</td>
                                <td>🖱️ Left click / ☝️ Single-finger-touch</td>
                            </tr>
                            <tr>
                                <td class="font-weight-bold">Moving</td>
                                <td>🖱️ Right click / ✌️ Two-finger-touch</td>
                            </tr>
                            <tr>
                                <td class="font-weight-bold">Zooming</td>
                                <td>🖱️ Scroll wheel / 🤏 Pinch</td>
                            </tr>
                        </tbody>
                    </table>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Show the login modal on page load
    $(document).ready(function () {
        $('#loginModal').modal('show');
    });

    // Join room button click event
    $('#joinRoom').click(function () {
        var userName = $('#userName').val().trim();
        if (userName) {
            window.userName = userName;
            localStorage.setItem('userName', userName);
            connection.invoke('JoinRoom', userName);
            $('#loginModal').modal('hide');
            
            // Notify chat.js
            window.dispatchEvent(new CustomEvent('userNameSet', { detail: userName }));
        } else {
            alert('Please enter your name');
        }
    });
</script>
